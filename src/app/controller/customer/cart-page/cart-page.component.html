<div class="container">
  <div class="cart-header">
    <h1><i class="fas fa-shopping-cart"></i> My Cart</h1>
  </div>

  <div class="cart-content">
    <div class="cart-items">
      <table class="cart-table" *ngIf="cartItems.length > 0; else emptyCart">
        <thead>
          <tr>
            <th>Product</th>
            <th style="text-align: right">Unit Price</th>
            <th>Quantity</th>
            <th style="text-align: right">Total</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of cartItems">
            <td>
              <div class="product-info">
                <img
                  [src]="'http://localhost:8080/image/' + item.mainImage"
                  alt="{{ item.productName }}"
                  class="product-image"
                />
                <div>
                  <div class="product-title">{{ item.productName }}</div>
                  <div class="seller-info">
                    Product Code: {{ item.productCode }}
                  </div>
                </div>
              </div>
            </td>
            <td class="price">à§³{{ item.price }}</td>
            <td>
              <div class="quantity-control">
                <button class="quantity-btn" (click)="decreaseQuantity(item)">
                  -
                </button>
                <input
                  type="text"
                  class="quantity-input"
                  [value]="item.quantity"
                  readonly
                />
                <button class="quantity-btn" (click)="increaseQuantity(item)">
                  +
                </button>
              </div>
            </td>
            <td class="price">à§³{{ item.totalPrice }}</td>
            <td>
              <button class="remove-btn" (click)="removeItemFromCart(item)">
                <i class="fas fa-trash-alt"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Empty Cart Message -->
      <ng-template #emptyCart>
        <div style="padding: 20px; text-align: center; font-size: 18px">
          ðŸ›’ Your cart is empty.
        </div>
      </ng-template>
    </div>

    <div class="cart-summary">
      <h3 class="summary-title">Order Summary</h3>

      <div class="price-row">
        <span>Items Price ({{ cartItems.length }} items)</span>
        <span>à§³{{ getItemsTotal() }}</span>
      </div>

      <div class="price-row">
        <span>Delivery Fee</span>
        <span>à§³{{ deliveryFee }}</span>
      </div>

      <div class="subtotal-row">
        <span>Subtotal</span>
        <span>à§³{{ getItemsTotal() + deliveryFee }}</span>
      </div>

      <!-- Coupon Section - Add this inside .cart-summary, above Order Summary -->
      <div class="coupon-section" style="margin-bottom: 20px">
        <label
          for="couponCode"
          style="display: block; margin-bottom: 6px; font-weight: 500"
        >
          Have a Coupon?
        </label>

        <div style="display: flex; align-items: center; gap: 10px">
          <input
            type="text"
            id="couponCode"
            [(ngModel)]="couponCode"
            placeholder="Enter coupon code"
            style="
              flex: 1;
              padding: 8px;
              border: 1px solid #ccc;
              border-radius: 4px;
            "
          />
          <button
            (click)="applyCoupon()"
            style="
              padding: 8px 16px;
              background-color: #f57224;
              color: white;
              border: none;
              border-radius: 4px;
              cursor: pointer;
            "
          >
            Apply
          </button>
        </div>

        <div
          *ngIf="couponMessage"
          [style.color]="couponMessageColor"
          style="margin-top: 8px; font-size: 14px"
        >
          {{ couponMessage }}
        </div>
      </div>

      <div class="vat-row">
        <span>VAT (15%)</span>
        <span>à§³{{ getVAT().toFixed(2) }}</span>
      </div>

      <div class="grand-total">
        <div class="price-row">
          <span>Grand Total</span>
          <span>à§³{{ getGrandTotal().toFixed(2) }}</span>
        </div>
      </div>

      <button class="checkout-btn" (click)="proceedToCheckout()">
        PROCEED TO CHECKOUT
      </button>

      <div class="secure-checkout">
        <i class="fas fa-lock"></i>
        <span>Secure Checkout</span>
      </div>
    </div>
  </div>
</div>

<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
/>
